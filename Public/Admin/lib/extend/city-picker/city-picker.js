layui.define(["jquery","layer","element","form"],function(t){var d=layui.$;"use strict";if(typeof ChineseDistricts==="undefined"){throw new Error('The file "city-picker.data.js" must be included first!')}var a="citypicker";var s="change."+a;var h="province";var l="city";var p="district";var o=function(t,e){this.$element=d(t);this.$dropdown=null;this.options=d.extend({},o.DEFAULTS,d.isPlainObject(e)&&e);this.active=false;this.dems=[];this.needBlur=false;this.init()};o.prototype={constructor:o,init:function(){this.defineDems();this.render();this.bind();this.active=true},render:function(){var t=this.getPosition(),e=this.$element.attr("placeholder")||this.options.placeholder,i='<span class="city-picker-span" style="'+this.getWidthStyle(t.width)+"height:"+(t.height-2)+"px;line-height:"+(t.height-1)+'px;">'+(e?'<span class="placeholder">'+e+"</span>":"")+'<span class="title"></span><div class="arrow"></div>'+"</span>",s='<div class="city-picker-dropdown" style="left:0px;top:100%;'+this.getWidthStyle(t.width,true)+'">'+'<div class="city-select-wrap">'+'<div class="city-select-tab">'+'<a class="active" data-count="province">省份</a>'+(this.includeDem("city")?'<a data-count="city">城市</a>':"")+(this.includeDem("district")?'<a data-count="district">区县</a>':"")+"</div>"+'<div class="city-select-content">'+'<div class="city-select province" data-count="province"></div>'+(this.includeDem("city")?'<div class="city-select city" data-count="city"></div>':"")+(this.includeDem("district")?'<div class="city-select district" data-count="district"></div>':"")+"</div></div>";this.$element.addClass("city-picker-input");this.$textspan=d(i).insertAfter(this.$element);this.$dropdown=d(s).insertAfter(this.$textspan);var n=this.$dropdown.find(".city-select");d.each(this.dems,d.proxy(function(t,e){this["$"+e]=n.filter("."+e+"")},this));this.refresh()},refresh:function(i){var t=this.$dropdown.find(".city-select");t.data("item",null);var s=this.$element.val()||"";s=s.split("/");d.each(this.dems,d.proxy(function(t,e){if(s[t]&&t<s.length){this.options[e]=s[t]}else if(i){this.options[e]=""}this.output(e)},this));this.tab(h);this.feedText();this.feedVal()},defineDems:function(){var i=false;if(this.options.provincename!==""){h=this.options.provincename}if(this.options.cityname!==""){l=this.options.cityename}if(this.options.districtname!==""){p=this.options.districtname}d.each([h,l,p],d.proxy(function(t,e){if(!i){this.dems.push(e)}if(e===this.options.level){i=true}},this))},includeDem:function(t){return d.inArray(t,this.dems)!==-1},getPosition:function(){var t,e,i,s,n;t=this.$element.position();s=this.getSize(this.$element);e=s.height;i=s.width;if(this.options.responsive){n=this.$element.offsetParent().width();if(n){i=i/n;if(i>.99){i=1}i=i*100+"%"}}return{top:t.top||0,left:t.left||0,height:e,width:i}},getSize:function(t){var e,i,s;if(!t.is(":visible")){e=d("<div />").appendTo(d("body"));e.css({position:"absolute !important",visibility:"hidden !important",display:"block !important"});i=t.clone().appendTo(e);s={width:i.outerWidth(),height:i.outerHeight()};e.remove()}else{s={width:t.outerWidth(),height:t.outerHeight()}}return s},getWidthStyle:function(t,e){if(this.options.responsive&&!d.isNumeric(t)){return"width:"+t+";"}else{return"width:"+(e?Math.max(320,t):t)+"px;"}},bind:function(){var c=this;d(document).on("click",this._mouteclick=function(t){var e=d(t.target);var i,s,n;if(e.is(".city-picker-span")){s=e}else if(e.is(".city-picker-span *")){s=e.parents(".city-picker-span")}if(e.is(".city-picker-input")){n=e}if(e.is(".city-picker-dropdown")){i=e}else if(e.is(".city-picker-dropdown *")){i=e.parents(".city-picker-dropdown")}if(!n&&!s&&!i||s&&s.get(0)!==c.$textspan.get(0)||n&&n.get(0)!==c.$element.get(0)||i&&i.get(0)!==c.$dropdown.get(0)){c.close(true)}});this.$element.on("change",this._changeElement=d.proxy(function(){this.close(true);this.refresh(true)},this)).on("focus",this._focusElement=d.proxy(function(){this.needBlur=true;this.open()},this)).on("blur",this._blurElement=d.proxy(function(){if(this.needBlur){this.needBlur=false;this.close(true)}},this));this.$textspan.on("click",function(t){var e=d(t.target),i;c.needBlur=false;if(e.is(".select-item")){i=e.data("count");c.open(i)}else{if(c.$dropdown.is(":visible")){c.close()}else{c.open()}}}).on("mousedown",function(){c.needBlur=false});this.$dropdown.on("click",".city-select a",function(){var t=d(this).parents(".city-select");var e=t.find("a.active");var i=t.next().length===0;e.removeClass("active");d(this).addClass("active");if(e.data("code")!==d(this).data("code")){t.data("item",{address:d(this).attr("title"),code:d(this).data("code")});d(this).trigger(s);c.feedText();c.feedVal();if(i){c.close()}}}).on("click",".city-select-tab a",function(){if(!d(this).hasClass("active")){var t=d(this).data("count");c.tab(t)}}).on("mousedown",function(){c.needBlur=false});if(this.$province){this.$province.on(s,this._changeProvince=d.proxy(function(){this.output(l);this.output(p);this.tab(l)},this))}if(this.$city){this.$city.on(s,this._changeCity=d.proxy(function(){this.output(p);this.tab(p)},this))}},open:function(t){t=t||h;this.$dropdown.show();this.$textspan.addClass("open").addClass("focus");this.tab(t)},close:function(t){this.$dropdown.hide();this.$textspan.removeClass("open");if(t){this.$textspan.removeClass("focus")}},unbind:function(){d(document).off("click",this._mouteclick);this.$element.off("change",this._changeElement);this.$element.off("focus",this._focusElement);this.$element.off("blur",this._blurElement);this.$textspan.off("click");this.$textspan.off("mousedown");this.$dropdown.off("click");this.$dropdown.off("mousedown");if(this.$province){this.$province.off(s,this._changeProvince)}if(this.$city){this.$city.off(s,this._changeCity)}},getText:function(){var i="";this.$dropdown.find(".city-select").each(function(){var t=d(this).data("item"),e=d(this).data("count");if(t){i+=(d(this).hasClass("province")?"":"/")+'<span class="select-item" data-count="'+e+'" data-code="'+t.code+'">'+t.address+'</span><input type="hidden" name="'+e+'_id"  value="'+t.code+'"  />'}});return i},getPlaceHolder:function(){return this.$element.attr("placeholder")||this.options.placeholder},feedText:function(){var t=this.getText();if(t){this.$textspan.find(">.placeholder").hide();this.$textspan.find(">.title").html(this.getText()).show()}else{this.$textspan.find(">.placeholder").text(this.getPlaceHolder()).show();this.$textspan.find(">.title").html("").hide()}},getVal:function(){var e="";this.$dropdown.find(".city-select").each(function(){var t=d(this).data("item");if(t){e+=(d(this).hasClass("province")?"":"/")+t.address}});return e},feedVal:function(){this.$element.val(this.getVal())},output:function(n){var t=this.options;var e=this["$"+n];var c=n===h?{}:[];var i;var s;var a;var o=null;var r;if(!e||!e.length){return}i=e.data("item");r=(i?i.address:null)||t[n];a=n===h?86:n===l?this.$province&&this.$province.find(".active").data("code"):n===p?this.$city&&this.$city.find(".active").data("code"):a;s=d.isNumeric(a)?ChineseDistricts[a]:null;if(d.isPlainObject(s)){d.each(s,function(t,e){var i;if(n===h){i=[];for(var s=0;s<e.length;s++){if(e[s].address===r){o={code:e[s].code,address:e[s].address}}i.push({code:e[s].code,address:e[s].address,selected:e[s].address===r})}c[t]=i}else{if(e===r){o={code:t,address:e}}c.push({code:t,address:e,selected:e===r})}})}e.html(n===h?this.getProvinceList(c):this.getList(c,n));e.data("item",o)},getProvinceList:function(t){var i=[],s=this,n=this.options.simple;d.each(t,function(t,e){i.push('<dl class="clearfix">');i.push("<dt>"+t+"</dt><dd>");d.each(e,function(t,e){i.push("<a"+' title="'+(e.address||"")+'"'+' data-code="'+(e.code||"")+'"'+' class="'+(e.selected?" active":"")+'">'+(n?s.simplize(e.address,h):e.address)+"</a>")});i.push("</dd></dl>")});return i.join("")},getList:function(t,i){var s=[],n=this,c=this.options.simple;s.push('<dl class="clearfix"><dd>');d.each(t,function(t,e){s.push("<a"+' title="'+(e.address||"")+'"'+' data-code="'+(e.code||"")+'"'+' class="'+(e.selected?" active":"")+'">'+(c?n.simplize(e.address,i):e.address)+"</a>")});s.push("</dd></dl>");return s.join("")},simplize:function(t,e){t=t||"";if(e===h){return t.replace(/[省,市,自治区,壮族,回族,维吾尔]/g,"")}else if(e===l){return t.replace(/[市,地区,回族,蒙古,苗族,白族,傣族,景颇族,藏族,彝族,壮族,傈僳族,布依族,侗族]/g,"").replace("哈萨克","").replace("自治州","").replace(/自治县/,"")}else if(e===p){return t.length>2?t.replace(/[市,区,县,旗]/g,""):t}},tab:function(t){var e=this.$dropdown.find(".city-select");var i=this.$dropdown.find(".city-select-tab > a");var s=this["$"+t];var n=this.$dropdown.find('.city-select-tab > a[data-count="'+t+'"]');if(s){e.hide();s.show();i.removeClass("active");n.addClass("active")}},reset:function(){this.$element.val(null).trigger("change")},destroy:function(){this.unbind();this.$element.removeData(a).removeClass("city-picker-input");this.$textspan.remove();this.$dropdown.remove()}};o.DEFAULTS={simple:false,responsive:false,placeholder:"请选择省/市/区",level:"district",provincename:"",cityname:"",districtname:"",province:"",city:"",district:""};o.setDefaults=function(t){d.extend(o.DEFAULTS,t)};o.other=d.fn.citypicker;d.fn.citypicker=function(n){var c=[].slice.call(arguments,1);return this.each(function(){var t=d(this);var e=t.data(a);var i;var s;if(!e){if(/destroy/.test(n)){return}i=d.extend({},t.data(),d.isPlainObject(n)&&n);t.data(a,e=new o(this,i))}if(typeof n==="string"&&d.isFunction(s=e[n])){s.apply(e,c)}})};d.fn.citypicker.Constructor=o;d.fn.citypicker.setDefaults=o.setDefaults;d.fn.citypicker.noConflict=function(){d.fn.citypicker=o.other;return this};t("citypicker",o)});