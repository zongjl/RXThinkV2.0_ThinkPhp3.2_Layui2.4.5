layui.define("form",function(e){var C=layui.$,b=layui.form,i=layui.hint(),D="selectPlus",g="layui-form-select",N="layui-form-selected",l={index:layui.selectPlus?layui.selectPlus.index:0,set:function(e){var a=this;a.config=C.extend({},a.config,e);return a},on:function(e,a){return layui.onevent.call(this,D,e,a)}},t=function(){var e=this,a=e.config;return{getChecked:function(){return e.getChecked.call(e)},config:a}},n=function(e){var a=this;a.index=++l.index;a.config=C.extend({},a.config,l.config,e);a.render()};n.prototype.config={type:"checkbox",valueSeparator:",",labelSeparator:"-",data:[],valueName:"title",valueId:"id",label:[],values:[],url:"",method:"post",where:"",contentType:"",headers:"",response:"data",parseData:null,config:{checkedName:"SELECTPLUS_CHECKED",indexName:"SELECTPLUS_INDEX"},error:""};n.prototype.render=function(){var e=this,l=e.config;typeof l.el==="string"?l.el=C(l.el):l.el;l.reElem=C('<div class="layui-unselect layui-form-select">'+'<div class="layui-select-title">'+'<input type="text" placeholder="请选择'+l.placeHolder+'" value="" readonly="" class="layui-input layui-unselect">'+'<i class="layui-edge"></i>'+"</div>"+'<dl class="layui-anim layui-anim-upbit">'+'<dd lay-value="" class="layui-select-tips layui-hide">请选择'+l.placeHolder+"</dd>"+"</dl>"+"</div>");l.reElem.find(".layui-select-title").on("click",function(e){!C(this).parent().hasClass(N)?C(document).find("."+g).removeClass(N):"";C(this).parent().toggleClass(N)});C(document).on("click",function(e){C(e.target).parents("."+g).length<=0&&l.reElem.hasClass(N)?l.reElem.removeClass(N):""});!Array.isArray(l.values)?l.values=[l.values]:"";l.filter=l.el.parents(".layui-form").attr("lay-filter");l.el.append(l.reElem);if(l.url){this.pullData()}else{e.renderData()}l.el.on("click",".layui-select-title",function(){var e=C(this),a=e.next().find("dd").eq(0);if(!a.hasClass("layui-hide")){a.addClass("layui-hide")}e.find("input").val(l.values.join(l.valueSeparator))})};n.prototype.pullData=function(){var a=this,l=a.config;C.ajax({type:l.method||"get",url:l.url,contentType:l.contentType,data:l.where||{},dataType:"json",headers:l.headers||{},success:function(e){if(typeof l.parseData==="function"){e=l.parseData(e)||e[l.response]}if(Array.isArray(e.data)){l.data=a.formatData(e.data);l.error="";a.renderData()}else{l.error="数据格式不对"}},error:function(e,a){l.error="数据接口请求异常："+a}})};n.prototype.formatData=function(t){var e=this,a=e.config,l=a.valueName,i=a.valueId,n=a.values,r=a.config.checkedName,c=a.config.indexName;layui.each(t,function(l,e){if(typeof e!=="object"){t[l]={title:e}}t[l][c]=l;if(!t[l][r])t[l][r]=false;layui.each(n,function(e,a){if(t[l][i]==a){t[l][r]=true}})});n.splice(0);return t};n.prototype.renderData=function(e){var a=this,x=a.config,l=x.type,t=a.index,e=e?a.formatData(e):a.formatData(x.data);items={checkbox:function(e,r,a){var c="layui-form-checkbox",d="layui-form-checked",l=e.reElem.find("dl"),u=e.valueName,o=e.valueId,s=e.config.checkedName,f=e.config.indexName,p=e.values,h=e.label,t=e.filter,y=e.labelSeparator,i=e.valueSeparator,v=e.elemId,m=0;l.append(C('<dd lay-value="全选"></dd>'));layui.each(r,function(e,a){l.append(C('<dd lay-value="'+a[u]+'"></dd>'))});var n=l.find("dd").eq(1);n.nextAll().each(function(e){var a=C(this),l=r[e],t=l[u],i=t;if(h.length>0){i="";layui.each(h,function(e,a){i+=l[a];e<h.length-1?i+=y:""})}var n=C('<input type="checkbox" name="'+v+"["+l[o]+']"  yw-index="'+l[f]+'" lay-skin="primary" title="'+i+'" layui-value="'+t+'">');if(l[s]){n.prop("checked",true);p.push(t);m++}a.html(n)});var k=C('<input type="checkbox"  selectplus-all  lay-skin="primary" title="全选" layui-value="全选">');m===r.length?k.prop("checked",true):"";n.html(k);n.parent().prev().find("input").val(p.join(i));n.on("click",function(e){var a=C(this),l=e.target.nodeName==="DD"?a.find("."+c).toggleClass(d).hasClass(d):a.find("input").prop("checked");a.parents("."+g).addClass(N);a.find("input").prop("checked",l);a.nextAll().each(function(){var e=C(this);l?e.find("."+c).addClass(d):e.find("."+c).removeClass(d);e.find("input").prop("checked",l)});layui.event.call(a,D,"checkbox"+"("+D+")",{type:"checkbox",ele:a,eleChecked:l,isAll:l})});n.nextAll().on("click",function(e){var a=C(this),l=e.target.nodeName==="DD"?a.find("."+c).toggleClass(d).hasClass(d):a.find("input").prop("checked");a.parents("."+g).addClass(N);a.find("input").prop("checked",l);var t=a.parents("dl").find("dd").eq(1),i=t.nextAll(),n=0;i.each(function(){C(this).find("input").prop("checked")?n++:""});if(n===i.length){t.find("input").prop("checked",true);t.find("."+c).addClass(d)}else{t.find("input").prop("checked",false);t.find("."+c).removeClass(d)}layui.event.call(t,D,"checkbox"+"("+D+")",{type:"checkbox",ele:a,eleChecked:l,isAll:n===i.length})});b.render("checkbox",t)},radio:function(e,r,a){var l="layui-form-radio",t="layui-form-radioed",i=["&#xe643;","&#xe63f;"],n="layui-anim-scaleSpring",c=e.el,d=e.reElem.find("dl"),u=e.valueName,o=e.valueId,s=e.config.checkedName,f=e.config.indexName,p=r.filter(function(e){return e[s]===true}),h=e.values,y=e.label,v=e.filter,m=e.labelSeparator,k=e.valueSeparator,g=e.elemId;layui.each(r,function(e,a){d.append('<dd lay-value="'+a[u]+'"></dd>')});b.render("select",x.filter);d.find("dd").eq(0).nextAll().each(function(e){var a=C(this),l=r[e],t=l[u],i=t;if(y.length>0){i="";layui.each(y,function(e,a){i+=l[a];e<y.length-1?i+=m:""})}var n=C('<input type="radio" name="'+g+"["+l[o]+']"  yw-index="'+l[f]+'" lay-skin="primary" title="'+i+'" layui-value="'+t+'">');if(p.length>0&&p[0][f]===l[f]){n.prop("checked",true);h.push(t);a.parent().prev().find("input").val(h.join(k))}a.html(n)});b.render("radio",v);d.find("dd").on("click",function(e){var a=C(this);a.find("."+l).addClass(t).find("i").addClass(n).html(i[0]);a.find("input").prop("checked",true);a.siblings().find("."+l).removeClass(t).find("i").removeClass(n).html(i[1]);a.siblings().find("input").prop("checked",false);layui.event.call(a,D,"radio"+"("+D+")",{type:"radio",ele:a,eleChecked:true,isAll:false})})}};layui.onevent.call(a,D,l+"("+D+")",a.checked.bind(a));items[l]?items[l](x,e,t):i.error("不支持的"+l+"表单渲染")};n.prototype.checked=function(e){var a=this,i=a.config,n=i.data,r=i.config.checkedName,l=e.type,t=e.isAll,c=e.ele,d=e.eleChecked,u=i.el.attr("lay-filter");if(l==="checkbox"){i.values=[];c.parents("dl").find('[type="checkbox"]').each(function(e){var a=C(this),l=a.attr("yw-index"),t=a.prop("checked");l?n[l][r]=t:"";t&&l?i.values.push(a.attr("layui-value")):""});c.parent().prev().find("input").val(i.values.join(i.valueSeparator));layui.event.call(c,D,D+"("+u+")",{checked:d,isAll:t,values:i.values,checkedData:n.filter(function(e){return e[r]===true}),ele:c})}else if(l==="radio"){var o=c.find("input").attr("yw-index"),s=c.find("input").attr("layui-value");i.values=[s];c.parent().prev().find("input").val(s);layui.each(n,function(e,a){a[r]=false});n[o][r]=true;layui.event.call(c,D,D+"("+u+")",{value:s,checkedData:n[o],ele:c})}};n.prototype.getChecked=function(){var e=this,a=e.config,l=a.data,t=a.config.checkedName;return{values:a.values,data:l.filter(function(e){return e[t]===true})}};l.render=function(e){var a=new n(e);return t.call(a)};e("selectPlus",l)});