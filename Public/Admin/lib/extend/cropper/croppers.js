layui.extend({cropper:"lib/extend/cropper/cropper"}).define(["jquery","layer","cropper"],function(e){var m=layui.$,g=layui.layer;var i={render:function(e){var i=this,a=e.elem,t=e.name,n=e.saveW,l=e.saveH,o=e.mark,r=e.area,s=e.url,c=e.done;var p='<link rel="stylesheet" href="/Public/Admin/lib/extend/cropper/cropper.css">\n'+'<div class="layui-fluid showImgEdit_'+t+'" style="display: none">\n'+'    <div class="layui-form-item" style="margin-top:10px;">\n'+'        <div class="layui-input-inline layui-btn-container" style="width: auto;">\n'+'            <label for="cropper_avatarImgUpload_'+t+'" class="layui-btn layui-btn-primary">\n'+'                <i class="layui-icon">&#xe67c;</i>选择图片\n'+"            </label>\n"+'            <input class="layui-upload-file" id="cropper_avatarImgUpload_'+t+'" type="file" value="选择图片" name="file">\n'+"        </div>\n"+'        <div class="layui-form-mid layui-word-aux">上传图片大小限定在500kb以内</div>\n'+"    </div>\n"+'    <div class="layui-row layui-col-space15">\n'+'        <div class="layui-col-xs9">\n'+'            <div class="readyimg" style="height:450px;background-color: rgb(247, 247, 247);">\n'+'                <img src="" >\n'+"            </div>\n"+"        </div>\n"+'        <div class="layui-col-xs3">\n'+'            <div class="img-preview" style="width:200px;height:200px;overflow:hidden">\n'+"            </div>\n"+"        </div>\n"+"    </div>\n"+'    <div class="layui-row layui-col-space15">\n'+'        <div class="layui-col-xs9">\n'+'            <div class="layui-row">\n'+'                <div class="layui-col-xs6">\n'+'                    <button type="button" class="layui-btn layui-icon layui-icon-left" cropper-event="rotate" data-option="-15" title="Rotate -90 degrees"> 向左旋转</button>\n'+'                    <button type="button" class="layui-btn layui-icon layui-icon-right" cropper-event="rotate" data-option="15" title="Rotate 90 degrees"> 向右旋转</button>\n'+"                </div>\n"+'                <div class="layui-col-xs5" style="text-align: right;">\n'+'                    <button type="button" class="layui-btn layui-icon layui-icon-refresh" cropper-event="reset" title="重置图片"></button>\n'+"                </div>\n"+"            </div>\n"+"        </div>\n"+'        <div class="layui-col-xs3">\n'+'            <button class="layui-btn layui-btn-fluid" cropper-event="confirmSave" type="button"> 保存修改</button>\n'+"        </div>\n"+"    </div>\n"+"\n"+"</div>";m("body").append(p);var d=m(".showImgEdit_"+t),u=m(".showImgEdit_"+t+" .readyimg img"),y=".showImgEdit_"+t+" .img-preview",v=m(".showImgEdit_"+t+" input[name='file']"),f={aspectRatio:o,preview:y,viewMode:1};m(a).on("click",function(){g.open({title:"选择图片裁剪",type:1,content:d,area:r,success:function(){u.cropper(f)},cancel:function(e){g.close(e);u.cropper("destroy")}});return false});m(".layui-btn").on("click",function(){var e=m(this).attr("cropper-event");if(e==="confirmSave"){u.cropper("getCroppedCanvas",{width:n,height:l}).toBlob(function(e){var i=new FormData;i.append("file",e,"head.jpg");var a=g.msg("图片保存中，请稍候",{icon:16,time:false,shade:.2});m.ajax({method:"post",url:s,data:i,processData:false,contentType:false,success:function(e){if(e.success){g.close(a);g.msg(e.msg,{icon:1});g.closeAll("page");return c(e.data)}else{g.close(a);g.alert(e.msg,{icon:2});return false}}})})}else if(e==="rotate"){var i=m(this).attr("data-option");u.cropper("rotate",i)}else if(e==="reset"){u.cropper("reset")}v.change(function(){var e=new FileReader;var i=this.files[0];e.readAsDataURL(i);e.onload=function(e){u.cropper("destroy").attr("src",this.result).cropper(f)}})})}};e("croppers",i)});