layui.define(["jquery","layer"],function(e){var a="tagsSelect";var m=layui.jquery,n=layui.layer;var l=function(e){this.disabledIndex=[];this.selected=[];this.values=[];this.names=[];this.config={elem:"",data:[],selected:[],tips:"请选择最多【{max}】个",max:5,width:null,verify:"",name:"",delimiter:",",field:{idName:"id",titleName:"name",statusName:"status"}};this.config=m.extend(this.config,e);this.createOption=function(){var e=this,i=e.config,l=i.field,a=i.data;var t=i.selected;$E=m(i.elem);var s=i.tips.replace("{max}",i.max);var n=i.name==""?i.elem.replace("#","").replace(".",""):i.name;var d=i.verify==""?"":'lay-verify="'+i.verify+'" ';var r="";r+='<div class="layui-unselect layui-form-select">';r+='<div class="layui-select-title">';r+="<input "+d+'name="'+n+'" type="text" readonly="" class="layui-input layui-unselect">';r+="</div>";r+='<div class="layui-input multiple">';r+="</div>";r+='<dl class="layui-anim layui-anim-upbit">';r+='<dd lay-value="" class="layui-select-tips">'+s+"</dd>";for(var u=0;u<a.length;u++){var o="",c="";if(a[u][l.statusName]==0){e.disabledIndex[a[u][l.idName]]=a[u][l.titleName];o=a[u][l.statusName]==0?"layui-disabled":"";c=a[u][l.statusName]==0?" layui-checkbox-disbaled layui-disabled":""}r+='<dd lay-value="'+a[u][l.idName]+'" class="'+o+'">';r+='<div class="layui-unselect layui-form-checkbox'+c+'" lay-skin="primary">';r+="<span>"+a[u][l.titleName]+'</span><i class="layui-icon">&#xe605;</i>';r+="</div>";r+="</dd>"}r+="</dl>";r+="</div>";$E.html(r)};this.set=function(e){var i=this,l=i.config;var a=typeof e=="undefined"?l.selected:e;$E=m(l.elem);$E.find(".layui-form-checkbox").removeClass("layui-form-checked");$E.find("dd").removeClass("layui-this");var t=a.length>l.max?l.max:a.length;for(var s=0;s<t;s++){if(a[s]&&!i.disabledIndex.hasOwnProperty(a[s])){$E.find("dd[lay-value="+a[s]+"]").addClass("layui-this")}}$E.find("dd.layui-this").each(function(){m(this).find("div").addClass("layui-form-checked")});i.setSelected(e)};this.setSelected=function(e){var i=this,l=i.config,a=l.field;$E=m(l.elem);var t=[],s=[],n=[],d=[];var r=$E.find("dd.layui-this");if(r.length==0){var u=l.tips.replace("{max}",l.max);d.push('<span class="tips">'+u+"</span>")}else{r.each(function(){$this=m(this);var e={};var i=$this.attr("lay-value");var l=$this.find("span").text();e[a.idName]=i;e[a.titleName]=l;t.push(i);s.push(l);d.push('<a href="javascript:;"><span lay-value="'+i+'">'+l+'</span><i class="layui-icon">&#x1006;</i></a>');n.push(e)})}d.push('<i class="layui-edge" style="pointer-events: none;"></i>');$E.find(".multiple").html(d.join(""));$E.find(".layui-select-title").find("input").each(function(){if(typeof e=="undefined"){this.defaultValue=t.join(l.delimiter)}this.value=t.join(l.delimiter)});var o=$E.find(".multiple").height()+14;$E.find(".layui-form-select dl").css("top",o+"px");i.values=t,i.names=s,i.selected=n};this.getData=function(e){var i;m.ajax({url:e,dataType:"json",async:false,success:function(e){i=e},error:function(){console.error(a+" hint：候选数据ajax请求错误 ");i=false}});return i}};l.prototype.render=function(){var t=this,s=t.config,e=s.field;$E=m(s.elem);if($E.length==0){console.error(a+" hint：找不到容器 "+s.elem);return false}if(Object.prototype.toString.call(s.data)!="[object Array]"){var i=t.getData(s.data);if(i===false){console.error(a+" hint：缺少分类数据");return false}t.config.data=i}$E.addClass("lay-ext-mulitsel");if(/^\d+$/.test(s.width)){$E.css("width",s.width+"px")}if(m("#lay-ext-mulitsel-style").length==0){var l=".lay-ext-mulitsel .layui-form-select dl dd div{margin-top:0px!important;}.lay-ext-mulitsel .layui-form-select dl dd.layui-this{background-color:#fff}.lay-ext-mulitsel .layui-input.multiple{line-height:auto;height:auto;padding:4px 25px 4px 10px;overflow:hidden;min-height:38px;margin-top:-38px;left:0;z-index:99;position:relative;background:#fff;}.lay-ext-mulitsel .layui-input.multiple a{padding:2px 5px;background:#5FB878;border-radius:2px;color:#fff;display:block;line-height:20px;height:20px;margin:2px 5px 2px 0;float:left;}.lay-ext-mulitsel .layui-input.multiple a i{margin-left:4px;font-size:14px;} .lay-ext-mulitsel .layui-input.multiple a i:hover{background-color:#009E94;border-radius:2px;}.lay-ext-mulitsel .danger{border:2px solid #FF5722 !important;-webkit-box-shadow: 0 0 5px rgba(255,87,34, .5);-moz-box-shadow: 0 0 5px rgba(255,87,34, .5);box-shadow: 0 0 5px rgba(255,87,34, .5);}.lay-ext-mulitsel .tips{pointer-events: none;position: absolute;left: 10px;top: 10px;color:#757575;}";m('<style id="lay-ext-mulitsel-style"></style>').text(l).appendTo(m("head"))}t.createOption();t.set();$E.on("click",".layui-select-title,.multiple,.multiple.layui-edge",function(e){m(".lay-ext-mulitsel").not(s.elem).removeClass("layui-form-selected");if(m(s.elem).is(".layui-form-selected")){m(s.elem).removeClass("layui-form-selected");m(document).off("click",mEvent)}else{m(s.elem).addClass("layui-form-selected");m(document).on("click",mEvent=function(e){if(e.target.id!==s.elem&&e.target.className!=="layui-input multiple"){m(s.elem).removeClass("layui-form-selected");m(document).off("click",mEvent)}})}});$E.on("click","dd",function(e){var i=m(this);if(i.hasClass("layui-disabled")){return false}if(i.is(".layui-select-tips")){i.siblings().removeClass("layui-this");m(s.elem).find(".layui-form-checkbox").removeClass("layui-form-checked")}else if(i.is(".layui-this")){i.removeClass("layui-this");i.find(".layui-form-checkbox").removeClass("layui-form-checked");e.stopPropagation()}else{if(t.selected.length>=s.max){m(s.elem+" .multiple").addClass("danger");n.tips("最多只能选择 "+s.max+" 个",s.elem+" .multiple",{tips:3,time:1e3,end:function(){m(s.elem+" .multiple").removeClass("danger")}});return false}else{i.addClass("layui-this");i.find(".layui-form-checkbox").addClass("layui-form-checked");e.stopPropagation()}}t.setSelected()});$E.on("click","a i",function(e){var i=m(this).prev("span");var l=i.attr("lay-value");if(l){var a=m(s.elem).find("dd[lay-value="+l+"]");a.removeClass("layui-this");a.find(".layui-form-checkbox").removeClass("layui-form-checked")}t.setSelected();i.parent().remove();e.stopPropagation()});$E.find("input").focus(function(){m(s.elem+" .multiple").addClass("danger");setTimeout(function(){m(s.elem+" .multiple").removeClass("danger")},3e3)})};e(a,function(e){var i=new l(e);i.render();return i})});